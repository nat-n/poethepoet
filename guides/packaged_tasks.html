<!doctype html>
<html class="no-js" lang="en" data-content_root="../">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<meta property="og:title" content="Loading tasks from a python package" />
<meta property="og:type" content="website" />
<meta property="og:url" content="guides/packaged_tasks.html" />
<meta property="og:site_name" content="Poe the Poet" />
<meta property="og:description" content="Usually tasks are declared in a config file such as pyproject.toml, however you can also define tasks in python, and include them into your project config via the include_script global option. This..." />
<meta name="description" content="Usually tasks are declared in a config file such as pyproject.toml, however you can also define tasks in python, and include them into your project config via the include_script global option. This..." />
<link rel="index" title="Index" href="../genindex.html" /><link rel="search" title="Search" href="../search.html" /><link rel="next" title="Global tasks" href="global_tasks.html" /><link rel="prev" title="Loading tasks from another file" href="include_guide.html" />
        <link rel="canonical" href="http://poethepoet.natn.io/guides/packaged_tasks.html" />

    <link rel="shortcut icon" href="../_static/favicon.ico"/><!-- Generated with Sphinx 7.4.7 and Furo 2023.09.10 -->
        <title>Loading tasks from a python package - Poe the Poet</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=8f2a1f02" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo.css?v=135e06be" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo-extensions.css?v=36a5483c" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../index.html"><div class="brand">Poe the Poet</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../index.html">
  
  <div class="sidebar-logo-container">
    <img class="sidebar-logo only-light" src="../_static/poe_logo_x2000.png" alt="Light Logo"/>
    <img class="sidebar-logo only-dark" src="../_static/poe_logo_x2000.png" alt="Dark Logo"/>
  </div>
  
  <span class="sidebar-brand-text">Poe the Poet</span>
  
</a><form class="sidebar-search-container" method="get" action="../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../poetry_plugin.html">Poetry plugin</a></li>
<li class="toctree-l1"><a class="reference internal" href="../global_options.html">Global options</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../tasks/index.html">Defining tasks</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle navigation of Defining tasks</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../tasks/options.html">Standard task options</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tasks/task_types/cmd.html">Command tasks</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tasks/task_types/script.html">Script tasks</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tasks/task_types/shell.html">Shell tasks</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tasks/task_types/sequence.html">Sequence tasks</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tasks/task_types/expr.html">Expression tasks</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tasks/task_types/switch.html">Switch tasks</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tasks/task_types/ref.html">Reference tasks</a></li>
</ul>
</li>
<li class="toctree-l1 current has-children"><a class="reference internal" href="index.html">Guides</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle navigation of Guides</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="running_guide.html">Running tasks</a></li>
<li class="toctree-l2"><a class="reference internal" href="help_guide.html">Documenting tasks</a></li>
<li class="toctree-l2"><a class="reference internal" href="args_guide.html">Configuring CLI arguments</a></li>
<li class="toctree-l2"><a class="reference internal" href="composition_guide.html">Composing tasks</a></li>
<li class="toctree-l2"><a class="reference internal" href="include_guide.html">Loading tasks from another file</a></li>
<li class="toctree-l2 current current-page"><a class="current reference internal" href="#">Loading tasks from a python package</a></li>
<li class="toctree-l2"><a class="reference internal" href="global_tasks.html">Global tasks</a></li>
<li class="toctree-l2"><a class="reference internal" href="without_poetry.html">Usage without poetry</a></li>
<li class="toctree-l2"><a class="reference internal" href="library_guide.html">Using poethepoet as a library</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../env_vars.html">Environment variables</a></li>
<li class="toctree-l1"><a class="reference internal" href="../license.html">Licence</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="edit-this-page">
  <a class="muted-link" href="https://github.com/nat-n/poethepoet/edit/main/docs/guides/packaged_tasks.rst" title="Edit this page">
    <svg aria-hidden="true" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <path d="M4 20h4l10.5 -10.5a1.5 1.5 0 0 0 -4 -4l-10.5 10.5v4" />
      <line x1="13.5" y1="6.5" x2="17.5" y2="10.5" />
    </svg>
    <span class="visually-hidden">Edit this page</span>
  </a>
</div><div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <section id="loading-tasks-from-a-python-package">
<h1>Loading tasks from a python package<a class="headerlink" href="#loading-tasks-from-a-python-package" title="Link to this heading">¶</a></h1>
<p>Usually tasks are declared in a config file such as pyproject.toml, however you can also define tasks in python, and <em>include</em> them into your project config via the <code class="docutils literal notranslate"><span class="pre">include_script</span></code> global option.</p>
<p>This is primarily intended to make it easier to reuse tasks across projects – by distributing them as a python package. However you can also use it to define tasks with a local script file.</p>
<section id="the-include-script-global-option">
<h2>The <code class="docutils literal notranslate"><span class="pre">include_script</span></code> global option<a class="headerlink" href="#the-include-script-global-option" title="Link to this heading">¶</a></h2>
<p>The following config loads the tasks generated by running the <code class="docutils literal notranslate"><span class="pre">get_tasks</span></code> function from the <code class="docutils literal notranslate"><span class="pre">mypkg</span></code> package. The package must be accessible to the default <a class="reference internal" href="../global_options.html#change-the-executor-type"><span class="std std-ref">executor</span></a>, i.e. it must be within the current project or its dependencies.</p>
<div class="highlight-toml notranslate"><div class="highlight"><pre><span></span><span class="k">[tool.poe]</span>
<span class="n">include_script</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;mypkg:get_tasks&quot;</span>
</pre></div>
</div>
<p>Just like for the <a class="reference internal" href="include_guide.html#loading-tasks-from-another-file"><span class="std std-ref">include</span></a> global option, you can also provide a multiple items like so:</p>
<div class="highlight-toml notranslate"><div class="highlight"><pre><span></span><span class="k">[tool.poe]</span>
<span class="n">include_script</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;mypkg:get_tasks&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;something.else:more_tasks&quot;</span><span class="p">]</span>
</pre></div>
</div>
<section id="passing-arguments-to-the-script">
<h3>Passing arguments to the script<a class="headerlink" href="#passing-arguments-to-the-script" title="Link to this heading">¶</a></h3>
<p>The syntax for the function reference is identical to a <a class="reference internal" href="../tasks/task_types/script.html"><span class="doc">script task</span></a>, meaning that it is also possible to pass arguments to the function like so:</p>
<div class="highlight-toml notranslate"><div class="highlight"><pre><span></span><span class="k">[tool.poe]</span>
<span class="n">include_script</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;mypkg:get_tasks(task_prefix=&#39;foo-&#39;, exclude_tasks=&#39;docs&#39;)&quot;</span>
</pre></div>
</div>
</section>
<section id="specifying-a-different-executor">
<h3>Specifying a different executor<a class="headerlink" href="#specifying-a-different-executor" title="Link to this heading">¶</a></h3>
<p>Normally Poe the Poet detects the most appropriate <a class="reference internal" href="../global_options.html#change-the-executor-type"><span class="std std-ref">executor</span></a> (i.e. project virtualenv) to use to find and execute the referenced package. However you can customize this behavior by specify an executor for the script like so:</p>
<div class="highlight-toml notranslate"><div class="highlight"><pre><span></span><span class="k">[[tool.poe.include_script]]</span>
<span class="n">script</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;mypkg:get_tasks&quot;</span>
<span class="n">executor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s2">&quot;virtualenv&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">location</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s2">&quot;../parent.venv&quot;</span><span class="w"> </span><span class="p">}</span>
</pre></div>
</div>
</section>
<section id="setting-a-working-directory-for-included-config">
<h3>Setting a working directory for included config<a class="headerlink" href="#setting-a-working-directory-for-included-config" title="Link to this heading">¶</a></h3>
<p>You can use the <code class="docutils literal notranslate"><span class="pre">cwd</span></code> option on an include_script to make the included tasks run with a different working directory. This option behaves exactly like the <a class="reference internal" href="include_guide.html#setting-a-working-directory-for-included-tasks"><span class="std std-ref">similar option for include items</span></a>.</p>
<div class="highlight-toml notranslate"><div class="highlight"><pre><span></span><span class="k">[tool.poe]</span>
<span class="n">include_script</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
<span class="w">  </span><span class="p">{</span><span class="w"> </span><span class="n">script</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s2">&quot;mypkg:get_tasks&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">cwd</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s2">&quot;./subproject1&quot;</span><span class="w"> </span><span class="p">}</span>
<span class="p">]</span>
</pre></div>
</div>
</section>
</section>
<section id="out-of-the-box-tasks-from-poethepoet-tasks">
<h2>Out-of-the-box tasks from <em>poethepoet-tasks</em><a class="headerlink" href="#out-of-the-box-tasks-from-poethepoet-tasks" title="Link to this heading">¶</a></h2>
<p>With <code class="docutils literal notranslate"><span class="pre">include_scripts</span></code> you can reuse common tasks in each new project by depending directly on a private or public <em>tasks package</em>. As an example the <a href="https://github.com/nat-n/poethepoet-tasks" target="_blank">poethepoet-tasks</a> package provides an opinionated collection of tasks to get you started, with two simple steps:</p>
<ol class="arabic">
<li><p>Add a dev dependency on <code class="docutils literal notranslate"><span class="pre">poethepoet-tasks</span></code></p>
<div class="literal-block-wrapper docutils container" id="id1">
<div class="code-block-caption"><span class="caption-text">with poetry</span><a class="headerlink" href="#id1" title="Link to this code">¶</a></div>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>poetry<span class="w"> </span>add<span class="w"> </span>poethepoet-tasks<span class="w"> </span>-G<span class="w"> </span>dev
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id2">
<div class="code-block-caption"><span class="caption-text">with uv</span><a class="headerlink" href="#id2" title="Link to this code">¶</a></div>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>uv<span class="w"> </span>add<span class="w"> </span>--dev<span class="w"> </span>poethepoet-tasks
</pre></div>
</div>
</div>
</li>
<li><p>Configure your project to include tasks from <code class="docutils literal notranslate"><span class="pre">poethepoet-tasks</span></code></p>
<div class="literal-block-wrapper docutils container" id="id3">
<div class="code-block-caption"><span class="caption-text">pyproject.toml</span><a class="headerlink" href="#id3" title="Link to this code">¶</a></div>
<div class="highlight-toml notranslate"><div class="highlight"><pre><span></span><span class="k">[tool.poe]</span>
<span class="n">include_script</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;poethepoet_tasks:tasks&quot;</span>
</pre></div>
</div>
</div>
</li>
</ol>
<p>See the docs for <a href="https://github.com/nat-n/poethepoet-tasks" target="_blank">poethepoet-tasks</a> for details of how you can include just a specific subset of available tasks.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>When you add a dev dependency on a <em>tasks package</em> like <em>poethepoet-tasks</em> you also automatically get all the other dev dependencies that it requires, e.g. ruff, pytest, etc. <em>poethepoet-tasks</em> also comes with config for ruff with opinionated defaults.</p>
</div>
</section>
<section id="create-your-own-tasks-package">
<h2>Create your own tasks package<a class="headerlink" href="#create-your-own-tasks-package" title="Link to this heading">¶</a></h2>
<p>To create your own tasks package, all you need is a python function that returns the required config structure (as a dict or json string), that can be imported from within your project, either from within the project itself or from a dependency.</p>
<section id="generating-config-directly">
<h3>Generating config directly<a class="headerlink" href="#generating-config-directly" title="Link to this heading">¶</a></h3>
<p>The following example illustrates defining a function that can be referenced by <code class="docutils literal notranslate"><span class="pre">include_script</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">generate_tasks</span><span class="p">():</span>
  <span class="k">return</span> <span class="p">{</span>
    <span class="s2">&quot;tasks&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="s2">&quot;test&quot;</span><span class="p">:</span> <span class="s2">&quot;pytest&quot;</span><span class="p">,</span>
      <span class="s2">&quot;build-proto&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;cmd&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">          protoc --proto_path=schemas --python_out=src/generated schemas/messages.proto</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">,</span>
        <span class="s2">&quot;help&quot;</span><span class="p">:</span> <span class="s2">&quot;Generate protobuf classes&quot;</span>
      <span class="p">},</span>
      <span class="s2">&quot;build&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;sequence&quot;</span><span class="p">:</span> <span class="p">[</span>
          <span class="s2">&quot;build-proto&quot;</span><span class="p">,</span>
          <span class="s2">&quot;test&quot;</span><span class="p">,</span>
          <span class="p">{</span> <span class="s2">&quot;cmd&quot;</span><span class="p">:</span> <span class="s2">&quot;poetry build&quot;</span> <span class="p">},</span>
        <span class="p">],</span>
        <span class="s2">&quot;help&quot;</span><span class="p">:</span> <span class="s2">&quot;Build that code&quot;</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
</pre></div>
</div>
<p>You may recognise the structure as identical to that supported when <a class="reference internal" href="include_guide.html"><span class="doc">loading tasks from another file</span></a>, which is a subset of the schema supported in the main project configuration, including <code class="docutils literal notranslate"><span class="pre">tasks</span></code> and the <code class="docutils literal notranslate"><span class="pre">env</span></code> and <code class="docutils literal notranslate"><span class="pre">envfile</span></code> <a class="reference internal" href="../global_options.html"><span class="doc">global options</span></a>.</p>
<p>There is no restriction on the arguments accepted by the function, or the logic used to generate the tasks. However it is critical that the function does not write anything to stdout.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>It is <strong>strongly recommended</strong> to minimize the code that must be imported or executed to generate the tasks configuration. This is because the poe CLI must create a python subprocess to import and execute the function every time it is used within the project; even when generating shell completions. This is also a good reason to ensure there are no side effects of this code or any of its imports.</p>
</div>
</section>
<section id="defining-a-taskcollection">
<h3>Defining a TaskCollection<a class="headerlink" href="#defining-a-taskcollection" title="Link to this heading">¶</a></h3>
<p>The recommended way to write tasks in python is to leverage the <strong>TaskCollection</strong> abstraction from <a href="https://github.com/nat-n/poethepoet-tasks" target="_blank">poethepoet-tasks</a>. It provides a convenient API for managing tasks, and allows users to select just the tasks they want via tags.</p>
<div class="literal-block-wrapper docutils container" id="id4">
<div class="code-block-caption"><span class="caption-text">src/my_tasks/__init__.py</span><a class="headerlink" href="#id4" title="Link to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">poethepoet_tasks</span><span class="w"> </span><span class="kn">import</span> <span class="n">TaskCollection</span>

<span class="n">tasks</span> <span class="o">=</span> <span class="n">TaskCollection</span><span class="p">()</span>

<span class="c1"># Define a simple cmd task</span>
<span class="n">tasks</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
    <span class="n">task_name</span><span class="o">=</span><span class="s2">&quot;test&quot;</span><span class="p">,</span>
    <span class="n">task_config</span><span class="o">=</span><span class="p">{</span>
        <span class="s2">&quot;help&quot;</span><span class="p">:</span> <span class="s2">&quot;Run project tests&quot;</span><span class="p">,</span>
        <span class="s2">&quot;cmd&quot;</span><span class="p">:</span> <span class="s2">&quot;pytest tests&quot;</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="n">tags</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;pytest&quot;</span><span class="p">],</span> <span class="c1"># tags are optional and allow consumers to select only the desired tasks</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<p>The TaskCollection instance is callable such that it can be referenced directly like so:</p>
<div class="literal-block-wrapper docutils container" id="id5">
<div class="code-block-caption"><span class="caption-text">pyproject.toml</span><a class="headerlink" href="#id5" title="Link to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">tool</span><span class="o">.</span><span class="n">poe</span><span class="p">]</span>
<span class="n">include_script</span> <span class="o">=</span> <span class="s2">&quot;my_tasks:tasks&quot;</span>
</pre></div>
</div>
</div>
<p>See here for a <a href="https://github.com/nat-n/poethepoet-tasks/blob/main/src/poethepoet_tasks/tasks.py" target="_blank">real world example</a> of creating a TaskCollection.</p>
</section>
<section id="decorating-functions-as-script-tasks">
<h3>Decorating functions as script tasks<a class="headerlink" href="#decorating-functions-as-script-tasks" title="Link to this heading">¶</a></h3>
<p>A TaskCollection can also be used to define inline <a class="reference internal" href="../tasks/task_types/script.html"><span class="doc">script tasks</span></a>. One nice pattern this enables is to have a <cite>tasks.py</cite> in the root of your project, similar to how one would work with <em>invoke</em>.</p>
<div class="literal-block-wrapper docutils container" id="id6">
<div class="code-block-caption"><span class="caption-text">tasks.py</span><a class="headerlink" href="#id6" title="Link to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">poethepoet_tasks</span><span class="w"> </span><span class="kn">import</span> <span class="n">TaskCollection</span>

<span class="n">tasks</span> <span class="o">=</span> <span class="n">TaskCollection</span><span class="p">()</span>

<span class="c1"># Define an inline script task</span>
<span class="nd">@tasks</span><span class="o">.</span><span class="n">script</span><span class="p">(</span><span class="n">tags</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;example&quot;</span><span class="p">])</span>
<span class="k">def</span><span class="w"> </span><span class="nf">hello</span><span class="p">(</span>
    <span class="n">foo</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span> <span class="c1"># This means preceding args will be positional, instead of CLI options</span>
    <span class="n">bar</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
    <span class="n">baz</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The first paragraph of the function docstring is picked up as the task help message!</span>

<span class="sd">    Args:</span>
<span class="sd">        foo: a positional argument for specifying foo</span>
<span class="sd">        bar: a number of things</span>
<span class="sd">        baz: to baz or not to baz</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">pass</span>
</pre></div>
</div>
</div>
<p>The above example is equivalent to the following toml based configuration:</p>
<div class="literal-block-wrapper docutils container" id="id7">
<div class="code-block-caption"><span class="caption-text">pyproject.toml</span><a class="headerlink" href="#id7" title="Link to this code">¶</a></div>
<div class="highlight-toml notranslate"><div class="highlight"><pre><span></span><span class="k">[tool.poe.tasks.hello]</span>
<span class="n">script</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;tasks:hello(foo, bar=bar, baz=baz)&quot;</span>
<span class="n">help</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;The first paragraph of the function docstring is picked up as the task help message!&quot;</span>
<span class="n">args</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
<span class="w">  </span><span class="p">{</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s2">&quot;foo&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">positional</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w"> </span><span class="n">help</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s2">&quot;a positional argument for specifying foo&quot;</span><span class="w"> </span><span class="p">},</span>
<span class="w">  </span><span class="p">{</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s2">&quot;bar&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">help</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s2">&quot;a number of things&quot;</span><span class="w"> </span><span class="p">},</span>
<span class="w">  </span><span class="p">{</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s2">&quot;baz&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">help</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s2">&quot;to baz or not to baz&quot;</span><span class="w"> </span><span class="p">}</span>
<span class="p">]</span>
</pre></div>
</div>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>When creating an inline script task via the TaskCollection decorator most of task options are automatically infered from the code, including task name, args, and help text (given a sufficient docstring).</p>
</div>
</section>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="global_tasks.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Global tasks</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="include_guide.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Loading tasks from another file</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; Nat Noordanus
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            <div class="icons">
              <a class="muted-link " href="https://pypi.org/project/poethepoet/" aria-label="PyPI">
                <svg version="1.1" xmlns="http://www.w3.org/2000/svg"  stroke="currentColor" fill="currentColor" stroke-width="0" width="16px" height="16" viewBox="0 0 512 512">
                    <path d="M454,305.8294373l-91.1191101,33.691803v106.4807434L181.94487,512V298.2970276l179.8842926-66.8633728V58.8240128L454,92.4968643V305.8294373z M276.8390503,363.3849487c-15.7174377,5.7245483-28.4572144,23.9239502-28.4515686,40.6481018c0.0061646,16.7174377,12.7523499,25.6329346,28.4636841,19.919281c15.7173462-5.7247009,28.4602051-23.9217834,28.4544983-40.6459656C305.303009,366.5810547,292.5565491,357.6635437,276.8390503,363.3849487z M334.6160889,212.4997864l-180.3925323,66.8782959l0.2966461,135.7604065l-64.2104874,22.9912415L0,405.2594604V191.9265442l90.704361-33.6917877V51.7543259L232.9717102,0l101.6443787,32.4636765V212.4997864z M215.2144775,94.8330383c-15.7174835,5.7222672-28.4621582,23.9249802-28.458725,40.6499329c0.0025787,16.725235,12.750824,25.6462555,28.4683228,19.9248505c15.7174988-5.7219086,28.4623871-23.9248047,28.4592285-40.6498184C243.6806641,98.0326996,230.9319763,89.1116333,215.2144775,94.8330383z"/>
                </svg>
            </a>
              <a class="muted-link " href="https://github.com/nat-n/poethepoet" aria-label="GitHub">
                <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 16 16">
                    <path fill-rule="evenodd" d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0 0 16 8c0-4.42-3.58-8-8-8z"></path>
                </svg>
            </a>
              
            </div>
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Loading tasks from a python package</a><ul>
<li><a class="reference internal" href="#the-include-script-global-option">The <code class="docutils literal notranslate"><span class="pre">include_script</span></code> global option</a><ul>
<li><a class="reference internal" href="#passing-arguments-to-the-script">Passing arguments to the script</a></li>
<li><a class="reference internal" href="#specifying-a-different-executor">Specifying a different executor</a></li>
<li><a class="reference internal" href="#setting-a-working-directory-for-included-config">Setting a working directory for included config</a></li>
</ul>
</li>
<li><a class="reference internal" href="#out-of-the-box-tasks-from-poethepoet-tasks">Out-of-the-box tasks from <em>poethepoet-tasks</em></a></li>
<li><a class="reference internal" href="#create-your-own-tasks-package">Create your own tasks package</a><ul>
<li><a class="reference internal" href="#generating-config-directly">Generating config directly</a></li>
<li><a class="reference internal" href="#defining-a-taskcollection">Defining a TaskCollection</a></li>
<li><a class="reference internal" href="#decorating-functions-as-script-tasks">Decorating functions as script tasks</a></li>
</ul>
</li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script src="../_static/documentation_options.js?v=ca1b380b"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/scripts/furo.js?v=32e29ea5"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script>
        (function(){
            var plausible_script = document.createElement('script');
            plausible_script.setAttribute('defer','true');
            plausible_script.setAttribute('data-domain','poethepoet.natn.io');
            plausible_script.setAttribute('src','https://plausible.io/js/script.js');
            document.head.appendChild(plausible_script);
        })()
        </script>
    </body>
</html>